const fs = require('fs');
const path = require('path');

const sourcePath = path.join(__dirname, 'src', 'app', 'layout.backup.tsx');
const targetPath = path.join(__dirname, 'src', 'app', 'layout.tsx');

if (!fs.existsSync(sourcePath)) {
  console.error('Backup layout file not found:', sourcePath);
  process.exit(1);
}

const restoreLayout = () => {
  const backupContent = fs.readFileSync(sourcePath, 'utf8');
  const currentContent = fs.existsSync(targetPath) ? fs.readFileSync(targetPath, 'utf8') : '';

  // Check if layout is the basic Next.js layout (indicating it was overwritten)
  const isBasicLayout = currentContent.includes('Generated by Next.js') || 
                       currentContent.includes('title: \'Next.js\'') ||
                       !currentContent.includes('TailTribe') ||
                       !currentContent.includes('Logo');

  if (isBasicLayout || backupContent !== currentContent) {
    console.log('Layout file has been overwritten or is incorrect. Restoring from backup...');
    fs.writeFileSync(targetPath, backupContent, 'utf8');
    console.log('Layout restored successfully.');
    return true;
  }
  return false;
};

// Initial check and restore
restoreLayout();

// Watch for changes every 500ms
setInterval(() => {
  restoreLayout();
}, 500);

console.log(`Aggressively monitoring ${targetPath} for changes...`);

